/**IPC functions. @preserve Copyright (c) 2021 Manuel LÃµhmus.*/
function argArrMap(n){return n.map(function(n){if(typeof n=="function"){var t="fn"+count++;return callbacks[t]=n,t}return n})}function netBackground(n,t,i="localhost"){var r=n;return net.createServer(function(n){n.on("data",function(t){var e=!1,i=JSON.parse(t),u=r[i.key],f;if(u||(u=callbacks[i.key],u&&delete callbacks[i.key]),typeof u=="function")i.argArr=i.argArr.map(function(t){return typeof t=="string"&&t.startsWith("fn")?(e=!0,function(){var i=Array.from(arguments);i=argArrMap(i,callbacks);n.write(JSON.stringify({argArr:[[t,i]]}))}):t}),f=u.apply(null,i.argArr),f?n.write(JSON.stringify({result:f})):e||n.end();else throw new Error("The '"+i.key+"' is undefined.");});n.on("close",function(n){console.log("Close connection. IsErr:"+n)})}).listen(t,i,function(){isDebug&&console.log("IPC service hostname:"+i+" port:"+t+" pid:"+process.pid)})}function netInterface(n,t,i="localhost"){var r={};return Object.keys(n).forEach(function(u){typeof n[u]=="function"&&(r[u]=function(){var r=Array.from(arguments),n=net.connect({port:t,host:i},function(){n.on("data",function(t){var i=JSON.parse(t);if(i.result)return n.end(),i.result;Array.isArray(i.argArr)&&i.argArr.forEach(function(t){typeof callbacks[t[0]]=="function"&&(t[1]=t[1].map(function(t){return typeof t=="string"&&t.startsWith("fn")?function(){var i=argArrMap(Array.from(arguments));n.write(JSON.stringify({key:t,argArr:i}))}:t}),callbacks[t[0]].apply(null,t[1]),delete callbacks[t[0]])})});r=argArrMap(r);n.write(JSON.stringify({key:u,argArr:r}));Object.keys(callbacks).length||n.end()})})}),r}function childBackground(n){if(process.send){var t=n;process.on("message",function(n){var i=JSON.parse(n),r=t[i.key],u;if(r||(r=callbacks[i.key],r&&delete callbacks[i.key]),typeof r=="function")i.argArr=i.argArr.map(function(n){return typeof n=="string"&&n.startsWith("fn")?function(){var t=Array.from(arguments);t=argArrMap(t,callbacks);process.send(JSON.stringify({argArr:[[n,t]]}))}:n}),u=r.apply(null,i.argArr),u&&process.send(JSON.stringify({result:u}));else throw new Error("The '"+i.key+"' is undefined.");})}}function childInterface(n,t){t.on("message",function(n){var i=JSON.parse(n);if(i.result)return i.result;Array.isArray(i.argArr)&&i.argArr.forEach(function(n){typeof callbacks[n[0]]=="function"&&(n[1]=n[1].map(function(n){return typeof n=="string"&&n.startsWith("fn")?function(){var i=argArrMap(Array.from(arguments));t.send(JSON.stringify({key:n,argArr:i}))}:n}),callbacks[n[0]].apply(null,n[1]),delete callbacks[n[0]])})});var i={};return Object.keys(n).forEach(function(r){typeof n[r]=="function"&&(i[r]=function(){var n=Array.from(arguments);n=argArrMap(n);t.send(JSON.stringify({key:r,argArr:n}))})}),i}function workerBackground(n){var t=require("worker_threads").parentPort,i;if(t&&typeof t.on=="function"){i=n;t.on("message",function(n){var r=JSON.parse(n),u=i[r.key],f;if(u||(u=callbacks[r.key],u&&delete callbacks[r.key]),typeof u=="function")r.argArr=r.argArr.map(function(n){return typeof n=="string"&&n.startsWith("fn")?function(){var i=Array.from(arguments);i=argArrMap(i,callbacks);t.postMessage(JSON.stringify({argArr:[[n,i]]}))}:n}),f=u.apply(null,r.argArr),f&&t.postMessage(JSON.stringify({result:f}));else throw new Error("The '"+r.key+"' is undefined.");})}}function workerInterface(n,t){if(t&&typeof t.on=="function"){t.on("message",function(n){var i=JSON.parse(n);if(i.result)return i.result;Array.isArray(i.argArr)&&i.argArr.forEach(function(n){typeof callbacks[n[0]]=="function"&&(n[1]=n[1].map(function(n){return typeof n=="string"&&n.startsWith("fn")?function(){var i=argArrMap(Array.from(arguments));t.postMessage(JSON.stringify({key:n,argArr:i}))}:n}),callbacks[n[0]].apply(null,n[1]),delete callbacks[n[0]])})});var i={};Object.keys(n).forEach(function(r){typeof n[r]=="function"&&(i[r]=function(){var n=Array.from(arguments);n=argArrMap(n);t.postMessage(JSON.stringify({key:r,argArr:n}))})})}return i}var nodeVersion;"use strict";var isDebug=Boolean(process.execArgv.find(function(n){return n.includes("--inspect")})),net=require("net"),callbacks={},count=1;if(exports.netBackground=netBackground,exports.netInterface=netInterface,exports.childBackground=childBackground,exports.childInterface=childInterface,exports.workerBackground=workerBackground,exports.workerInterface=workerInterface,nodeVersion=process.versions.node.split(/[.]/),nodeVersion[0]>14&&nodeVersion[1]>3){function n(n,t){var u={},f=require("worker_threads"),i=new f.BroadcastChannel(t),r;if(i)return u=n,i.onmessage=function(n){var t=JSON.parse(n.data),i=u[t.key],r;if(i||(i=callbacks[t.key],i&&delete callbacks[t.key]),typeof i=="function")t.argArr=t.argArr.map(function(t){return typeof t=="string"&&t.startsWith("fn")?function(){var i=Array.from(arguments);i=argArrMap(i,callbacks);n.postMessage(JSON.stringify({argArr:[[t,i]]}))}:t}),r=i.apply(null,t.argArr),r&&n.postMessage(JSON.stringify({result:r}));else throw new Error("The '"+t.key+"' is undefined.");},r={},Object.keys(n).forEach(function(t){typeof n[t]=="function"&&(r[t]=function(){var n=Array.from(arguments);n=argArrMap(n);i.postMessage(JSON.stringify({key:t,argArr:n}))})}),r}exports.broadcast=n}